(()=>{var j=Object.create,p=Object.defineProperty,F=Object.getPrototypeOf,A=Object.prototype.hasOwnProperty,V=Object.getOwnPropertyNames,T=Object.getOwnPropertyDescriptor,L=r=>p(r,"__esModule",{value:!0}),N=(r,e,t)=>{if(L(r),e&&typeof e=="object"||typeof e=="function")for(let i of V(e))!A.call(r,i)&&i!=="default"&&p(r,i,{get:()=>e[i],enumerable:!(t=T(e,i))||t.enumerable});return r},q=r=>r&&r.__esModule?r:N(p(r!=null?j(F(r)):{},"default",{value:r,enumerable:!0}),r),f=q(require("rxjs")),v=class{constructor(){this.subjects={}}listen(e,t){return this.subjects[e]||(this.subjects[e]=new f.Subject),this.subjects[e].subscribe(t)}emit(e,t){this.subjects[e]||(this.subjects[e]=new f.Subject),this.subjects[e].next(t)}dispose(){for(let e in this.subjects)this.subjects[e].complete();this.subjects={}}},d=v,X={broadcast:!1},H={broadcast:!1},l=class{constructor({data:e,expiresAt:t=null}){this.data=e,this.expiresAt=t}isResolving(){return this.data instanceof Promise}hasExpired(){return this.expiresAt===null||this.expiresAt<new Date}expiresIn(e){return this.expiresAt=new Date,this.expiresAt.setMilliseconds(this.expiresAt.getMilliseconds()+e),this}},D=class{constructor(){this.elements=new Map;this.event=new d}resolve(e,t){Promise.resolve(t.data).then(i=>{if(i==null)return this.remove(e);t.data=i,this.broadcast(e,i)})}get(e){return this.elements.get(e)}set(e,t){this.elements.set(e,t),this.resolve(e,t)}remove(e,t){let{broadcast:i}={...X,...t};i&&this.broadcast(e,void 0),this.elements.delete(e)}clear(e){let{broadcast:t}={...H,...e};if(t)for(let i of this.elements.keys())this.broadcast(i,void 0);this.elements.clear()}has(e){return this.elements.has(e)}subscribe(e,t){return this.event.listen(e,t)}broadcast(e,t){this.event.emit(e,t)}};var z=r=>fetch(r).then(e=>{if(!e.ok)throw Error("Not a 2XX response.");return e.json()}),R={cache:new D,errors:new d,fetcher:z,initialData:void 0,loadInitialCache:!0,revalidateOnStart:!0,dedupingInterval:2e3,revalidateOnFocus:!0,focusThrottleInterval:5e3,revalidateOnReconnect:!0},b={...R,force:!1},m={revalidate:!0,revalidateOptions:{...b}},S={broadcast:!1};var B=class{constructor(e){this.options={...R,...e}}get cache(){return this.options.cache}get errors(){return this.options.errors}requestData(e,t){return t(e).catch(i=>{this.errors.emit(e,i);return})}resolveKey(e){if(typeof e=="function")try{return e()}catch{return}return e}clear(e,t){let i={...S,...t};if(e==null)return this.cache.clear(i);if(!Array.isArray(e))return this.cache.remove(e,i);for(let n of e)this.cache.remove(n,i)}revalidate(e,t){if(!e)return;let{fetcher:i,dedupingInterval:n}=this.options,{force:a,fetcher:s,dedupingInterval:c}={...b,fetcher:i,dedupingInterval:n,...t},o;(a||!this.cache.has(e)||this.cache.has(e)&&this.cache.get(e).hasExpired())&&(o=this.requestData(e,s)),o!==void 0&&this.mutate(e,new l({data:o}).expiresIn(c),{revalidate:!1})}mutate(e,t,i){if(!e)return;let{revalidate:n,revalidateOptions:a}={...m,...i},s;if(typeof t=="function"){let c=null;if(this.cache.has(e)){let o=this.cache.get(e);o.isResolving()||(c=o.data)}s=t(c)}else s=t;this.cache.set(e,s instanceof l?s:new l({data:s})),n&&this.revalidate(e,a)}subscribe(e,t){if(e){let i=this.cache.subscribe(e,t);return()=>i.unsubscribe()}return()=>{}}subscribeErrors(e,t){if(e){let i=this.errors.listen(e,t);return()=>i.unsubscribe()}return()=>{}}subscribeVisibility(e,{throttleInterval:t=5e3,enabled:i=!0}={}){if(i&&typeof window!="undefined"){let n=null,a=()=>{let s=Date.now();(n===null||s-n>t)&&(n=s,e())};return window.addEventListener("focus",a),()=>window.removeEventListener("focus",a)}return()=>{}}subscribeNetwork(e,{enabled:t=!0}={}){return t&&typeof window!="undefined"?(window.addEventListener("online",e),()=>window.removeEventListener("online",e)):()=>{}}get(e){if(e&&this.cache.has(e)){let t=this.cache.get(e);if(!t.isResolving())return t.data}return}getOrWait(e){return new Promise(t=>{let i=this.get(e);if(i)return t(i);let n=this.subscribe(e,a=>(n(),t(a)))})}use(e,t,i,n){let{fetcher:a,initialData:s,loadInitialCache:c,revalidateOnStart:o,dedupingInterval:W,revalidateOnFocus:O,focusThrottleInterval:C,revalidateOnReconnect:y}={...this.options,...n},x=(u,M)=>this.mutate(this.resolveKey(e),u,M),K=u=>this.revalidate(this.resolveKey(e),u),h=()=>K({fetcher:a,dedupingInterval:W});o&&h();let w=this.subscribe(this.resolveKey(e),t),g=this.subscribeErrors(this.resolveKey(e),i),I=this.subscribeVisibility(h,{throttleInterval:C,enabled:O}),E=this.subscribeNetwork(h,{enabled:y}),P=()=>{w(),g(),I(),E()};if(s&&x(s,{revalidate:!1}),c){let u=this.get(this.resolveKey(e));u&&t(u)}return{unsubscribe:P}}};})();
/*! Copyright (c) Èrik C. Forés - MIT */
