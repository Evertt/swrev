var V=Object.create,C=Object.defineProperty,N=Object.getPrototypeOf,q=Object.prototype.hasOwnProperty,X=Object.getOwnPropertyNames,H=Object.getOwnPropertyDescriptor,z=a=>C(a,"__esModule",{value:!0}),B=(a,e)=>()=>(e||(e={exports:{}},a(e.exports,e)),e.exports),G=(a,e,t)=>{if(z(a),e&&typeof e=="object"||typeof e=="function")for(let r of X(e))!q.call(a,r)&&r!=="default"&&C(a,r,{get:()=>e[r],enumerable:!(t=H(e,r))||t.enumerable});return a},J=a=>a&&a.__esModule?a:G(C(a!=null?V(N(a)):{},"default",{value:a,enumerable:!0}),a),x=B((Y,E)=>{var O={};try{O.EventTarget=new EventTarget().constructor}catch(a){(function(e,t){var r=e.create,i=e.defineProperty,o=s.prototype;u(o,"addEventListener",function(n,c,l){for(var p=t.get(this),h=p[n]||(p[n]=[]),v=0,R=h.length;v<R;v++)if(h[v].listener===c)return;h.push({target:this,listener:c,options:l})}),u(o,"dispatchEvent",function(n){var c=t.get(this),l=c[n.type];return l&&(u(n,"target",this),u(n,"currentTarget",this),l.slice(0).forEach(d,n),delete n.currentTarget,delete n.target),!0}),u(o,"removeEventListener",function(n,c){for(var l=t.get(this),p=l[n]||(l[n]=[]),h=0,v=p.length;h<v;h++)if(p[h].listener===c){p.splice(h,1);return}}),O.EventTarget=s;function s(){"use strict";t.set(this,r(null))}function u(n,c,l){i(n,c,{configurable:!0,writable:!0,value:l})}function d(n){var c=n.options;c&&c.once&&n.target.removeEventListener(this.type,n.listener),typeof n.listener=="function"?n.listener.call(n.target,this):n.listener.handleEvent(this)}})(Object,new WeakMap)}E.exports=O.EventTarget}),m=J(x()),K={broadcast:!1},w={broadcast:!1},D=class{constructor({data:e,expiresAt:t=null}){this.data=e,this.expiresAt=t}isResolving(){return this.data instanceof Promise}hasExpired(){return this.expiresAt===null||this.expiresAt<new Date}expiresIn(e){return this.expiresAt=new Date,this.expiresAt.setMilliseconds(this.expiresAt.getMilliseconds()+e),this}},S=class{constructor(){this.elements=new Map;this.event=new m.default}resolve(e,t){Promise.resolve(t.data).then(r=>{if(r==null)return this.remove(e);t.data=r,this.broadcast(e,r)})}get(e){return this.elements.get(e)}set(e,t){this.elements.set(e,t),this.resolve(e,t)}remove(e,t){let{broadcast:r}={...K,...t};r&&this.broadcast(e,void 0),this.elements.delete(e)}clear(e){let{broadcast:t}={...w,...e};if(t)for(let r of this.elements.keys())this.broadcast(r,void 0);this.elements.clear()}has(e){return this.elements.has(e)}subscribe(e,t){this.event.addEventListener(e,t)}unsubscribe(e,t){this.event.removeEventListener(e,t)}broadcast(e,t){this.event.dispatchEvent(new CustomEvent(e,{detail:t}))}};var Q=a=>fetch(a).then(e=>{if(!e.ok)throw Error("Not a 2XX response.");return e.json()}),W={cache:new S,errors:new m.default,fetcher:Q,initialData:void 0,loadInitialCache:!0,revalidateOnStart:!0,dedupingInterval:2e3,revalidateOnFocus:!0,focusThrottleInterval:5e3,revalidateOnReconnect:!0},b={...W,force:!1},g={revalidate:!0,revalidateOptions:{...b}},y={broadcast:!1};var I=class{constructor(e){this.options={...W,...e}}get cache(){return this.options.cache}get errors(){return this.options.errors}requestData(e,t){return t(e).catch(r=>{this.errors.dispatchEvent(new CustomEvent(e,{detail:r}));return})}resolveKey(e){if(typeof e=="function")try{return e()}catch{return}return e}clear(e,t){let r={...y,...t};if(e==null)return this.cache.clear(r);if(!Array.isArray(e))return this.cache.remove(e,r);for(let i of e)this.cache.remove(i,r)}revalidate(e,t){if(!e)return;let{fetcher:r,dedupingInterval:i}=this.options,{force:o,fetcher:s,dedupingInterval:u}={...b,fetcher:r,dedupingInterval:i,...t},d;(o||!this.cache.has(e)||this.cache.has(e)&&this.cache.get(e).hasExpired())&&(d=this.requestData(e,s)),d!==void 0&&this.mutate(e,new D({data:d}).expiresIn(u),{revalidate:!1})}mutate(e,t,r){if(!e)return;let{revalidate:i,revalidateOptions:o}={...g,...r},s;if(typeof t=="function"){let u=null;if(this.cache.has(e)){let d=this.cache.get(e);d.isResolving()||(u=d.data)}s=t(u)}else s=t;this.cache.set(e,s instanceof D?s:new D({data:s})),i&&this.revalidate(e,o)}subscribe(e,t){if(e){let r=({detail:i})=>t(i);return this.cache.subscribe(e,r),()=>this.cache.unsubscribe(e,r)}return()=>{}}subscribeErrors(e,t){if(e){let r=({detail:i})=>t(i);return this.errors.addEventListener(e,r),()=>this.errors.removeEventListener(e,r)}return()=>{}}subscribeVisibility(e,{throttleInterval:t=5e3,enabled:r=!0}={}){if(r&&typeof window!="undefined"){let i=null,o=()=>{let s=Date.now();(i===null||s-i>t)&&(i=s,e())};return window.addEventListener("focus",o),()=>window.removeEventListener("focus",o)}return()=>{}}subscribeNetwork(e,{enabled:t=!0}={}){return t&&typeof window!="undefined"?(window.addEventListener("online",e),()=>window.removeEventListener("online",e)):()=>{}}get(e){if(e&&this.cache.has(e)){let t=this.cache.get(e);if(!t.isResolving())return t.data}return}getOrWait(e){return new Promise(t=>{let r=this.get(e);if(r)return t(r);let i=this.subscribe(e,o=>(i(),t(o)))})}use(e,t,r,i){let{fetcher:o,initialData:s,loadInitialCache:u,revalidateOnStart:d,dedupingInterval:n,revalidateOnFocus:c,focusThrottleInterval:l,revalidateOnReconnect:p}={...this.options,...i},h=(f,A)=>this.mutate(this.resolveKey(e),f,A),v=f=>this.revalidate(this.resolveKey(e),f),R=()=>v({fetcher:o,dedupingInterval:n});d&&R();let P=this.subscribe(this.resolveKey(e),t),T=this.subscribeErrors(this.resolveKey(e),r),M=this.subscribeVisibility(R,{throttleInterval:l,enabled:c}),L=this.subscribeNetwork(R,{enabled:p}),F=()=>{P(),T(),M(),L()};if(s&&h(s,{revalidate:!1}),u){let f=this.get(this.resolveKey(e));f&&t(f)}return{unsubscribe:F}}};export{D as CacheItem,S as DefaultCache,I as SWR,w as defaultCacheClearOptions,K as defaultCacheRemoveOptions,y as defaultClearOptions,g as defaultMutateOptions,W as defaultOptions,b as defaultRevalidateOptions};
/*! (c) Andrea Giammarchi - ISC */
/*! Copyright (c) Èrik C. Forés - MIT */
